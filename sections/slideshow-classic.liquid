{%- liquid
  assign has_multiple_slides = false
  if section.blocks.size > 1
    assign has_multiple_slides = true
  endif

  assign autoplay_enabled = false
  if section.settings.autoplay and has_multiple_slides
    assign autoplay_enabled = true
  endif

  assign slideshow_class = ''
  if section.settings.edge_to_edge
    assign slideshow_class = slideshow_class | append: ' section--full-width'
  else
    assign slideshow_class = slideshow_class | append: ' section--page-width'
  endif

  case section.settings.section_size
    when 'small'
      assign slide_height = 'small'
    when 'medium'
      assign slide_height = 'medium'
    when 'large'
      assign slide_height = 'large'
    else
      assign slide_height = 'auto'
  endcase
-%}

<div class="section-background color-{{ section.settings.color_scheme | default: 'primary' }}"></div>
<div class="slideshow-section spacing-style section {{ slideshow_class }} color-{{ section.settings.color_scheme | default: 'primary' }}" style="--slide-min-height: var(--slide-min-height-{{ section.settings.section_size | default: 'auto' }});">
  {% if section.blocks.size > 1 %}
    {% capture controls %}
      {% render 'slideshow-controls',
        style: 'dots',
        autoplay: autoplay_enabled,
        item_count: section.blocks.size,
        show_arrows: true,
        arrows_on_media: true,
        controls_on_media: true,
        pagination_position: 'center'
      %}
    {% endcapture %}
  {% endif %}

  {% render 'slideshow',
    class: '',
    controls: controls,
    show_arrows: true,
    autoplay: autoplay_enabled,
    autoplay_speed: section.settings.cycle_speed,
    slides: slides,
    slide_count: section.blocks.size,
    slide_size: slide_height
  %}
</div>

{% capture slides %}
  {%- for block in section.blocks -%}
    {%- liquid
      assign block_index = forloop.index0
      assign is_first = forloop.first
    -%}

    {%- capture slide_content -%}
      <div class="slide__image-container">
        {%- unless block.settings.image -%}
          {%- liquid
            assign modulo_result = block_index | modulo: 2
            assign placeholder_variant = 2 | minus: modulo_result
            assign placeholder_name = 'hero-apparel-' | append: placeholder_variant
          -%}
          {{ placeholder_name | placeholder_svg_tag: 'slide__image' }}
        {%- endunless -%}

        {%- if block.settings.image -%}
          {%- liquid
            if is_first
              assign loading = 'eager'
              assign fetchpriority = 'high'
            else
              assign loading = 'lazy'
              assign fetchpriority = 'low'
            endif

            assign height = block.settings.image.width | divided_by: block.settings.image.aspect_ratio | round
            assign sizes = '100vw'
            assign widths = '832, 1200, 1600, 1920, 2560, 3840'
          -%}

          <div class="{% if block.settings.mobile_image %}hidden-phone{% endif %}">
            {{
              block.settings.image
              | image_url: width: 3840
              | image_tag: height: height, sizes: sizes, widths: widths, class: 'slide__image', loading: loading, fetchpriority: fetchpriority
            }}
          </div>

          {%- if block.settings.mobile_image -%}
            <div class="hidden-tablet-and-up">
              {{
                block.settings.mobile_image
                | image_url: width: 3840
                | image_tag: height: height, sizes: sizes, widths: widths, class: 'slide__image', loading: loading, fetchpriority: fetchpriority
              }}
            </div>
          {%- endif -%}
        {%- endif -%}

        {%- if block.settings.show_overlay -%}
          {% render 'overlay',
            settings: block.settings,
            overlay_color: block.settings.overlay_color | default: '#00000026'
          %}
        {%- endif -%}
      </div>

      {%- if block.settings.title != blank or block.settings.content != blank or block.settings.button_text != blank -%}
        <div class="spacing-style slide__content color-{{ block.settings.color_scheme | default: section.settings.color_scheme | default: 'primary' }} background-transparent" style="{% render 'spacing-style', settings: block.settings %}">
          <div class="layout-panel-flex layout-panel-flex--column" style="align-items: {{ block.settings.content_alignment | default: 'center' }}; justify-content: {{ block.settings.vertical_position | default: 'center' }};">
            {%- if block.settings.title != blank -%}
              <h2 class="heading h1" style="color: {{ block.settings.text_color | default: 'inherit' }}; margin-bottom: var(--padding-sm);">{{ block.settings.title | escape }}</h2>
            {%- endif -%}

            {%- if block.settings.content != blank -%}
              <p style="color: {{ block.settings.text_color | default: 'inherit' }}; margin-bottom: var(--padding-md);">{{ block.settings.content | escape | newline_to_br }}</p>
            {%- endif -%}

            {%- if block.settings.link != blank and block.settings.button_text != blank -%}
              <a href="{{ block.settings.link }}" class="button" style="color: {{ block.settings.button_text_color }}; background: {{ block.settings.button_background }};">{{ block.settings.button_text | escape }}</a>
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}

      {%- if block.settings.link != blank and block.settings.button_text == blank -%}
        <a href="{{ block.settings.link }}" class="slideshow__slide-link" aria-label="{{ block.settings.title | default: 'Slide link' }}"></a>
      {%- endif -%}
    {%- endcapture -%}

    {%- capture class -%}
      {%- if block.settings.inherit_color_scheme == false -%}
        color-{{ block.settings.color_scheme }}
      {%- endif -%}
    {%- endcapture -%}

    {% render 'slideshow-slide',
      index: block_index,
      class: class,
      children: slide_content,
      attributes: block.shopify_attributes,
      slide_id: block.id,
      slide_size: slide_height,
      navigate_to_slide: true
    %}
  {%- endfor -%}
{% endcapture %}

{% stylesheet %}
  .shopify-section-{{ section.id }} .slideshow-section {
    --slide-min-height-auto: auto;
    --slide-min-height-small: 30dvh;
    --slide-min-height-medium: 35dvh;
    --slide-min-height-large: 40dvh;
  }

  .slideshow__slide-link {
    position: absolute;
    inset: 0;
    z-index: 10;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Classic slideshow",
  "max_blocks": 6,
  "settings": [
    {
      "type": "checkbox",
      "id": "edge_to_edge",
      "label": "Full-width",
      "default": false
    },
    {
      "type": "select",
      "id": "section_size",
      "label": "Image size",
      "options": [
        {
          "value": "preserve_ratio",
          "label": "Original image ratio"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "preserve_ratio"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto rotate between slides",
      "default": true
    },
    {
      "type": "range",
      "id": "cycle_speed",
      "min": 3,
      "max": 8,
      "step": 1,
      "unit": "sec",
      "label": "Change slides every",
      "default": 5
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "primary"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "2160 x 720px .jpg recommended"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image",
          "info": "750 x 1100px .jpg recommended. If none is set, desktop image will be used."
        },
        {
          "type": "checkbox",
          "id": "show_overlay",
          "label": "Show overlay",
          "info": "Increase text readability on busy images.",
          "default": false
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Overlay color",
          "alpha": true,
          "default": "#00000026",
          "info": "Only works if overlay is enabled"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#ffffff"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Slide title"
        },
        {
          "type": "textarea",
          "id": "content",
          "label": "Content",
          "default": "Tell your story"
        },
        {
          "type": "select",
          "id": "content_alignment",
          "label": "Content alignment",
          "options": [
            {
              "value": "flex-start",
              "label": "Left"
            },
            {
              "value": "center",
              "label": "Center"
            },
            {
              "value": "flex-end",
              "label": "Right"
            }
          ],
          "default": "center"
        },
        {
          "type": "select",
          "id": "vertical_position",
          "label": "Vertical position",
          "options": [
            {
              "value": "flex-start",
              "label": "Top"
            },
            {
              "value": "center",
              "label": "Middle"
            },
            {
              "value": "flex-end",
              "label": "Bottom"
            }
          ],
          "default": "center"
        },
        {
          "type": "header",
          "content": "Button"
        },
        {
          "type": "color",
          "id": "button_background",
          "label": "Button background",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "button_text_color",
          "label": "Button text color",
          "default": "#000000"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Shop now"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "If no button text is set, the whole image becomes clickable."
        },
        {
          "type": "header",
          "content": "Appearance"
        },
        {
          "type": "checkbox",
          "id": "inherit_color_scheme",
          "label": "Inherit color scheme",
          "default": true,
          "info": "When enabled, content will use the section color scheme"
        },
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "Content color scheme",
          "default": "scheme-1",
          "info": "Only applies when 'Inherit color scheme' is disabled"
        },
        {
          "type": "header",
          "content": "Padding"
        },
        {
          "type": "range",
          "id": "padding-block-start",
          "label": "Top padding",
          "min": 0,
          "max": 100,
          "step": 4,
          "unit": "px",
          "default": 48
        },
        {
          "type": "range",
          "id": "padding-block-end",
          "label": "Bottom padding",
          "min": 0,
          "max": 100,
          "step": 4,
          "unit": "px",
          "default": 48
        },
        {
          "type": "range",
          "id": "padding-inline-start",
          "label": "Left padding",
          "min": 0,
          "max": 100,
          "step": 4,
          "unit": "px",
          "default": 48
        },
        {
          "type": "range",
          "id": "padding-inline-end",
          "label": "Right padding",
          "min": 0,
          "max": 100,
          "step": 4,
          "unit": "px",
          "default": 48
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "Image",
      "name": "Classic slideshow",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
