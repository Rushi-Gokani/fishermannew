{%- comment -%}
  Product Card Snippet - New Design
  Features: Best Seller badge, heart icon, image with dots, Buy Now button (#E1EDF5)

  @param {object} product - The product object
  @param {object} children - The children of the product card
  @param {object} [block] - The block object
{%- endcomment -%}

{% assign block_settings = block.settings %}
{% assign card_id = block.id | append: '-' | append: product.id %}

{% liquid
  assign on_sale = false
  if product.compare_at_price > product.price
    assign on_sale = true
  endif

  assign sold_out = false
  unless product.available
    assign sold_out = true
  endunless

  assign show_badge = false
  if product.tags contains 'best-seller' or product.tags contains 'Best Seller'
    assign show_badge = true
  endif
%}

{% style %}
  .product-card-{{ card_id }} {
    background-color: #FFFFFF;
    border: 1px solid #F0F0F0;
    border-radius: 16px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.3s ease, transform 0.3s ease;
  }

  .product-card-{{ card_id }}:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    transform: translateY(-4px);
  }

  /* Top section - Badge and Heart */
  .product-card-top-{{ card_id }} {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
  }

  .product-card-badge-{{ card_id }} {
    background-color: #FFFFFF;
    color: #000000;
    font-size: 14px;
    font-weight: 700;
    padding: 6px 12px;
    border-radius: 4px;
  }

  .product-card-wishlist-{{ card_id }} {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
  }

  .product-card-wishlist-{{ card_id }}:hover {
    transform: scale(1.1);
  }

  .product-card-wishlist-{{ card_id }} svg {
    width: 24px;
    height: 24px;
    color: #FF0000;
    fill: none;
    transition: fill 0.2s ease;
  }

  .product-card-wishlist-{{ card_id }}.active svg {
    fill: #FF0000;
  }

  /* Image section */
  .product-card-image-wrapper-{{ card_id }} {
    position: relative;
    margin-bottom: 16px;
  }

  .product-card-image-{{ card_id }} {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: contain;
    border-radius: 8px;
  }

  /* Pagination dots */
  .product-card-dots-{{ card_id }} {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    margin-top: 8px;
  }

  .product-card-dot-{{ card_id }} {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #CCCCCC;
    transition: background-color 0.3s ease;
    cursor: pointer;
  }

  .product-card-dot-{{ card_id }}.active {
    background-color: #008000;
  }

  /* Bottom section */
  .product-card-content-{{ card_id }} {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .product-card-brand-{{ card_id }} {
    font-size: 12px;
    font-weight: 400;
    color: #008000;
    margin: 0;
  }

  .product-card-title-{{ card_id }} {
    font-size: 16px;
    font-weight: 700;
    color: #000000;
    margin: 0;
    line-height: 1.3;
  }

  .product-card-title-{{ card_id }} a {
    color: inherit;
    text-decoration: none;
    transition: opacity 0.3s ease;
  }

  .product-card-title-{{ card_id }} a:hover {
    opacity: 0.7;
  }

  .product-card-price-{{ card_id }} {
    font-size: 14px;
    font-weight: 400;
    color: #000000;
    margin: 0;
  }

  .product-card-price-{{ card_id }} .compare-price {
    text-decoration: line-through;
    opacity: 0.6;
    margin-left: 8px;
  }

  /* Buy Now button */
  .product-card-buy-btn-{{ card_id }} {
    width: 100%;
    background-color: #E1EDF5;
    color: #000000;
    font-size: 16px;
    font-weight: 700;
    border: none;
    border-radius: 12px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 8px;
  }

  .product-card-buy-btn-{{ card_id }}:hover:not(:disabled) {
    opacity: 0.9;
    transform: scale(1.02);
  }

  .product-card-buy-btn-{{ card_id }}:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  @media screen and (max-width: 749px) {
    .product-card-title-{{ card_id }} {
      font-size: 14px;
    }

    .product-card-buy-btn-{{ card_id }} {
      font-size: 14px;
      padding: 12px;
    }
  }
{% endstyle %}

<div class="product-card-{{ card_id }}">
  <!-- Top Section: Badge and Heart -->
  <div class="product-card-top-{{ card_id }}">
    {% if show_badge %}
      <span class="product-card-badge-{{ card_id }}">Best Seller</span>
    {% endif %}
    <button
      class="product-card-wishlist-{{ card_id }}"
      aria-label="Add to wishlist"
      data-product-handle="{{ product.handle }}"
      onclick="toggleWishlist(this, '{{ product.handle }}')"
    >
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
    </button>
  </div>

  <!-- Image Section -->
  <div class="product-card-image-wrapper-{{ card_id }}">
    {% if product.featured_image %}
      <img
        src="{{ product.featured_image | image_url: width: 400 }}"
        alt="{{ product.featured_image.alt | escape }}"
        loading="lazy"
        width="400"
        height="400"
        class="product-card-image-{{ card_id }}"
        id="product-image-{{ card_id }}"
      >
    {% else %}
      {{ 'product-' | append: product.id | placeholder_svg_tag: 'product-card-image-' | append: card_id }}
    {% endif %}

    <!-- Pagination Dots -->
    {% if product.media.size > 1 %}
      <div class="product-card-dots-{{ card_id }}" id="dots-{{ card_id }}">
        {% for media in product.media limit: 3 %}
          <span
            class="product-card-dot-{{ card_id }}{% if forloop.first %} active{% endif %}"
            data-index="{{ forloop.index }}"
            onclick="changeImage('{{ card_id }}', {{ forloop.index }}, [
              {% for media in product.media limit: 3 %}
                '{{ media | image_url: width: 400 }}'{% unless forloop.last %},{% endunless %}
              {% endfor %}
            ])"
          ></span>
        {% endfor %}
      </div>
    {% else %}
      <div class="product-card-dots-{{ card_id }}">
        <span class="product-card-dot-{{ card_id }} active"></span>
        <span class="product-card-dot-{{ card_id }}"></span>
        <span class="product-card-dot-{{ card_id }}"></span>
      </div>
    {% endif %}
  </div>

  <!-- Bottom Section: Brand, Title, Price, Button -->
  <div class="product-card-content-{{ card_id }}">
    {% if product.vendor %}
      <p class="product-card-brand-{{ card_id }}">{{ product.vendor }}</p>
    {% endif %}

    <h3 class="product-card-title-{{ card_id }}">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>

    <p class="product-card-price-{{ card_id }}">
      {% if on_sale %}
        <span class="sale-price">{{ product.price | money }}</span>
        <span class="compare-price">{{ product.compare_at_price | money }}</span>
      {% else %}
        {{ product.price | money }}
      {% endif %}
    </p>

    <form method="post" action="/cart/add" class="product-card-form-{{ card_id }}">
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" />
      <button
        type="submit"
        class="product-card-buy-btn-{{ card_id }}"
        {% if sold_out %}disabled{% endif %}
      >
        {% if sold_out %}
          Sold Out
        {% else %}
          Buy Now
        {% endif %}
      </button>
    </form>
  </div>
</div>

<script>
  // Image gallery for this card
  function changeImage(cardId, index, images) {
    const img = document.getElementById('product-image-' + cardId);
    const dotsContainer = document.getElementById('dots-' + cardId);
    const dots = dotsContainer?.querySelectorAll('.product-card-dot-' + cardId);

    if (img && images[index - 1]) {
      img.src = images[index - 1];
      if (dots) {
        dots.forEach(d => d.classList.remove('active'));
        dots[index - 1]?.classList.add('active');
      }
    }
  }

  // Wishlist toggle
  function toggleWishlist(button, productHandle) {
    button.classList.toggle('active');
    // You can add localStorage or API call here
    const isActive = button.classList.contains('active');
    if (isActive) {
      // Add to wishlist logic
      console.log('Added to wishlist:', productHandle);
    } else {
      // Remove from wishlist logic
      console.log('Removed from wishlist:', productHandle);
    }
  }
</script>
